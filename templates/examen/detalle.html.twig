{% extends 'base.html.twig' %}

{% block title %}Detalle del Examen{% endblock %}

{% block body %}
<div class="card">
    <div class="card-header">
        <h1>Examen del {{ examen.fecha|date('d/m/Y H:i') }}</h1>
        {% if is_granted('ROLE_PROFESOR') or is_granted('ROLE_ADMIN') %}
            <p style="margin: 0.5rem 0 0 0; font-size: 1rem; opacity: 0.9;">
                Alumno: <strong>{{ examen.usuario.nombreDisplay }}</strong>
            </p>
        {% endif %}
    </div>
    <div class="card-body">
        <div style="text-align: center; padding: 2rem; background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-light) 100%); color: white; border-radius: 8px; margin-bottom: 2rem;">
            <h2 style="margin: 0; font-size: 3rem;">{{ examen.nota|number_format(2, ',', '.') }}</h2>
        </div>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
            <div class="card" style="text-align: center;">
                <div class="card-body">
                    <h3 style="color: var(--color-success); font-size: 2rem; margin: 0;">{{ examen.aciertos }}</h3>
                    <p style="margin: 0.5rem 0 0 0;">Aciertos</p>
                </div>
            </div>
            <div class="card" style="text-align: center;">
                <div class="card-body">
                    <h3 style="color: var(--color-danger); font-size: 2rem; margin: 0;">{{ examen.errores }}</h3>
                    <p style="margin: 0.5rem 0 0 0;">Errores</p>
                </div>
            </div>
            {% if examen.enBlanco > 0 %}
                <div class="card" style="text-align: center;">
                    <div class="card-body">
                        <h3 style="color: #999; font-size: 2rem; margin: 0;">{{ examen.enBlanco }}</h3>
                        <p style="margin: 0.5rem 0 0 0;">En blanco</p>
                    </div>
                </div>
            {% endif %}
            <div class="card" style="text-align: center;">
                <div class="card-body">
                    <h3 style="color: var(--color-primary); font-size: 2rem; margin: 0;">{{ examen.numeroPreguntas }}</h3>
                    <p style="margin: 0.5rem 0 0 0;">Total</p>
                </div>
            </div>
        </div>

        <div class="mb-3">
            <strong>Dificultad:</strong> <span class="badge badge-{{ examen.dificultad }}">{{ examen.getDificultadLabel() }}</span>
        </div>

        <details class="mb-4" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 1rem;">
            <summary style="cursor: pointer; font-weight: bold; color: var(--color-primary); font-size: 1.1rem; user-select: none; outline: none;">
                üìö Informaci√≥n del Examen
            </summary>
            <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #dee2e6;">
                {% if examen.convocatoria %}
                    <div style="margin-bottom: 0.75rem;">
                        <strong>Convocatoria:</strong> <span class="badge" style="background-color: #9C27B0;">{{ examen.convocatoria.nombre }}</span>
                    </div>
                    <div style="margin-bottom: 0.75rem;">
                        <strong>Municipios de la Convocatoria:</strong>
                        {% if examen.convocatoria.municipios|length > 0 %}
                            {% for municipio in examen.convocatoria.municipios %}
                                <span class="badge" style="background-color: #2196F3;">{{ municipio.nombre }}</span>
                            {% endfor %}
                        {% else %}
                            <span class="text-muted">No hay municipios asignados</span>
                        {% endif %}
                    </div>
                    <div>
                        <strong>Temas Municipales:</strong>
                        {% if examen.temasMunicipales|length > 0 %}
                            <div style="margin-top: 0.5rem; display: flex; flex-wrap: wrap; gap: 0.5rem;">
                                {% for temaMunicipal in examen.temasMunicipales %}
                                    <span class="badge badge-facil">{{ temaMunicipal.nombre }} ({{ temaMunicipal.municipio.nombre }})</span>
                                {% endfor %}
                            </div>
                        {% else %}
                            <span class="text-muted">No hay temas municipales asignados</span>
                        {% endif %}
                    </div>
                {% elseif examen.municipio %}
                    <div style="margin-bottom: 0.75rem;">
                        <strong>Municipio:</strong> <span class="badge" style="background-color: #2196F3;">{{ examen.municipio.nombre }}</span>
                    </div>
                    <div>
                        <strong>Temas Municipales:</strong>
                        {% if examen.temasMunicipales|length > 0 %}
                            <div style="margin-top: 0.5rem; display: flex; flex-wrap: wrap; gap: 0.5rem;">
                                {% for temaMunicipal in examen.temasMunicipales %}
                                    <span class="badge badge-facil">{{ temaMunicipal.nombre }}</span>
                                {% endfor %}
                            </div>
                        {% else %}
                            <span class="text-muted">No hay temas municipales asignados</span>
                        {% endif %}
                    </div>
                {% else %}
                    <div>
                        <strong>Temas:</strong>
                        {% if examen.temas|length > 0 %}
                            <div style="margin-top: 0.5rem; display: flex; flex-wrap: wrap; gap: 0.5rem;">
                                {% for tema in examen.temas %}
                                    <span class="badge badge-facil">{{ tema.nombre }}</span>
                                {% endfor %}
                            </div>
                        {% else %}
                            <span class="text-muted">No hay temas asignados</span>
                        {% endif %}
                    </div>
                {% endif %}
            </div>
        </details>

        <h3 style="margin-top: 2rem; margin-bottom: 1rem;">Detalle de Preguntas</h3>

        {# Lista de n√∫meros de preguntas clicables #}
        <div style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 0.75rem; margin-bottom: 1.5rem;">
            <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                <span style="font-size: 0.85rem; color: #666; font-weight: 500;">üìã Navegaci√≥n r√°pida:</span>
                <span style="font-size: 0.75rem; color: #999;">(Haz clic en cualquier n√∫mero para ir a esa pregunta)</span>
            </div>
            <div style="display: flex; flex-wrap: wrap; gap: 0.35rem; justify-content: flex-start;">
                {% for item in preguntas %}
                    <a href="#pregunta-{{ loop.index }}" 
                       class="pregunta-link-detalle"
                       style="display: inline-flex; align-items: center; justify-content: center; 
                              min-width: 32px; height: 32px; 
                              border-radius: 4px; 
                              text-decoration: none; 
                              font-weight: 500; 
                              font-size: 0.8rem;
                              transition: all 0.2s;
                              cursor: pointer;
                              user-select: none;
                              {% if item.esCorrecta is null %}
                                  background: #e0e0e0;
                                  color: #666;
                                  border: 2px solid #999;
                              {% elseif item.esCorrecta %}
                                  background: #28a745;
                                  color: white;
                                  border: 2px solid #28a745;
                              {% else %}
                                  background: #dc3545;
                                  color: white;
                                  border: 2px solid #dc3545;
                              {% endif %}"
                       onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 2px 6px rgba(0,0,0,0.15)';"
                       onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='none';">
                        {{ loop.index }}
                    </a>
                {% endfor %}
            </div>
            <div style="display: flex; gap: 1rem; margin-top: 0.5rem; font-size: 0.75rem; color: #666; flex-wrap: wrap;">
                <span style="display: flex; align-items: center; gap: 0.25rem;">
                    <span style="display: inline-block; width: 16px; height: 16px; background: #28a745; border-radius: 3px; border: 1px solid #28a745;"></span>
                    <span>Correcta</span>
                </span>
                <span style="display: flex; align-items: center; gap: 0.25rem;">
                    <span style="display: inline-block; width: 16px; height: 16px; background: #dc3545; border-radius: 3px; border: 1px solid #dc3545;"></span>
                    <span>Incorrecta</span>
                </span>
                <span style="display: flex; align-items: center; gap: 0.25rem;">
                    <span style="display: inline-block; width: 16px; height: 16px; background: #e0e0e0; border-radius: 3px; border: 1px solid #999;"></span>
                    <span>Sin responder</span>
                </span>
            </div>
        </div>

        {# Filtros de preguntas #}
        <div id="filtros-preguntas" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 1rem; margin-bottom: 1.5rem;">
            <div style="font-size: 0.85rem; color: #666; font-weight: 500; margin-bottom: 0.75rem;">üîç Filtrar preguntas:</div>
            <div style="display: flex; flex-wrap: wrap; gap: 1rem; align-items: center;">
                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; user-select: none; font-size: 0.9rem; color: #333;">
                    <input type="checkbox" id="filtro-correctas" class="filtro-pregunta" data-tipo="correcta" checked style="width: 18px; height: 18px; cursor: pointer;">
                    <span style="display: flex; align-items: center; gap: 0.25rem;">
                        <span style="display: inline-block; width: 16px; height: 16px; background: #28a745; border-radius: 3px; border: 1px solid #28a745;"></span>
                        <span>Correctas</span>
                    </span>
                </label>
                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; user-select: none; font-size: 0.9rem; color: #333;">
                    <input type="checkbox" id="filtro-incorrectas" class="filtro-pregunta" data-tipo="incorrecta" checked style="width: 18px; height: 18px; cursor: pointer;">
                    <span style="display: flex; align-items: center; gap: 0.25rem;">
                        <span style="display: inline-block; width: 16px; height: 16px; background: #dc3545; border-radius: 3px; border: 1px solid #dc3545;"></span>
                        <span>Incorrectas</span>
                    </span>
                </label>
                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; user-select: none; font-size: 0.9rem; color: #333;">
                    <input type="checkbox" id="filtro-en-blanco" class="filtro-pregunta" data-tipo="en-blanco" checked style="width: 18px; height: 18px; cursor: pointer;">
                    <span style="display: flex; align-items: center; gap: 0.25rem;">
                        <span style="display: inline-block; width: 16px; height: 16px; background: #e0e0e0; border-radius: 3px; border: 1px solid #999;"></span>
                        <span>En blanco</span>
                    </span>
                </label>
            </div>
        </div>

        {% for item in preguntas %}
            <div id="pregunta-{{ loop.index }}" class="card mb-3 pregunta-item {% if item.esCorrecta is null %}pregunta-en-blanco{% elseif item.esCorrecta %}pregunta-correcta{% else %}pregunta-incorrecta{% endif %}" style="{% if item.esCorrecta is null %}border-left: 4px solid #999;{% elseif item.esCorrecta %}border-left: 4px solid var(--color-success);{% else %}border-left: 4px solid var(--color-danger);{% endif %}">
                <div class="card-body">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                        <div style="flex: 1;">
                            <h4 style="margin: 0;">Pregunta {{ loop.index }}</h4>
                        </div>
                        {% if item.esCorrecta is null %}
                            <span class="badge" style="background-color: #999; color: white;">‚óã Sin responder</span>
                        {% elseif item.esCorrecta %}
                            <span class="badge badge-facil">‚úì Correcta</span>
                        {% else %}
                            <span class="badge badge-dificil">‚úó Incorrecta</span>
                        {% endif %}
                    </div>

                    {# Informaci√≥n Legal: Tema, Ley y Art√≠culo en secci√≥n amarilla - Organizado verticalmente #}
                    {% if not esMunicipal and not esConvocatoria %}
                        {% set esTema17 = (item.pregunta.tema and ('Tema 17' in item.pregunta.tema.nombre or 'accidente de tr√°fico' in item.pregunta.tema.nombre|lower)) or (item.pregunta.ley and item.pregunta.ley.nombre == 'Accidentes de Tr√°fico') %}
                        {% if item.pregunta.ley or (item.pregunta.articulo and not esTema17 and item.pregunta.articulo.numero != 0) or item.pregunta.tema %}
                            <div class="form-group mb-3">
                                <div style="padding: 0.75rem 1rem; background: linear-gradient(135deg, #fff3cd 0%, #ffe69c 100%); border-left: 4px solid #ffc107; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); display: flex; flex-direction: column; gap: 0.75rem;">
                                    <div style="color: #856404; font-size: 0.85rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; border-bottom: 1px solid rgba(133, 100, 4, 0.2); padding-bottom: 0.5rem; margin-bottom: 0.25rem;">
                                        üìã Informaci√≥n de la pregunta
                                    </div>
                                    {% if item.pregunta.tema %}
                                        <div style="color: #856404; font-size: 0.9rem; font-weight: 500;">üè∑Ô∏è <strong>{{ item.pregunta.tema.nombre }}</strong></div>
                                    {% endif %}
                                    {% if item.pregunta.ley %}
                                        <div style="color: #856404; font-size: 0.9rem; font-weight: 600;">üìú {{ item.pregunta.ley.nombre }}</div>
                                    {% endif %}
                                    {% if item.pregunta.articulo and not esTema17 and item.pregunta.articulo.numero != 0 %}
                                        <div style="color: #856404; font-size: 0.9rem; font-weight: 600;">
                                            üìÑ Art. {{ item.pregunta.articulo.getNumeroCompleto() }}
                                            {% if item.pregunta.articulo.nombre %}
                                                - {{ item.pregunta.articulo.nombre }}
                                            {% endif %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        {% endif %}
                    {% elseif item.pregunta.temaMunicipal %}
                        {# Para municipales, mostrar solo el tema en una secci√≥n similar #}
                        <div class="form-group mb-3">
                            <div style="padding: 0.75rem 1rem; background: linear-gradient(135deg, #fff3cd 0%, #ffe69c 100%); border-left: 4px solid #ffc107; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); display: flex; flex-direction: column; gap: 0.75rem;">
                                <div style="color: #856404; font-size: 0.85rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; border-bottom: 1px solid rgba(133, 100, 4, 0.2); padding-bottom: 0.5rem; margin-bottom: 0.25rem;">
                                    üìã Informaci√≥n de la pregunta
                                </div>
                                <span style="color: #856404; font-size: 0.9rem; font-weight: 500;">üè∑Ô∏è <strong>{{ item.pregunta.temaMunicipal.nombre }}</strong></span>
                            </div>
                        </div>
                    {% endif %}

                    <p><strong>{{ item.pregunta.texto }}</strong></p>

                    <div style="margin: 1rem 0;">
                        {# Normalizar respuesta correcta y respuesta del alumno para comparaci√≥n #}
                        {% set respuestaCorrectaRaw = item.pregunta.respuestaCorrecta ?? item.pregunta.getRespuestaCorrecta() ?? '' %}
                        {% set respuestaCorrectaNormalizada = respuestaCorrectaRaw ? (respuestaCorrectaRaw|trim|upper) : '' %}
                        {% set respuestaAlumnoNormalizada = item.respuestaAlumno ? (item.respuestaAlumno|trim|upper) : '' %}
                        {# Opci√≥n A #}
                        {% set esCorrectaA = respuestaCorrectaNormalizada == 'A' %}
                        {% set esSeleccionadaA = respuestaAlumnoNormalizada == 'A' %}
                        {% set esIncorrectaA = esSeleccionadaA and not item.esCorrecta %}
                        {% set esCorrectaYSeleccionadaA = esSeleccionadaA and item.esCorrecta %}
                        <div style="padding: 0.5rem; margin: 0.25rem 0; {% if esIncorrectaA %}background: #ffebee;{% elseif esCorrectaA %}background: #e8f5e9; border-left: 3px solid var(--color-success);{% endif %}">
                            <strong>A)</strong> {{ item.pregunta.opcionA }}
                            {% if esCorrectaYSeleccionadaA %}
                                <span style="color: var(--color-success); font-weight: bold;">‚Üê Tu respuesta (correcta)</span>
                            {% elseif esIncorrectaA %}
                                <span style="color: var(--color-danger);">‚Üê Tu respuesta (incorrecta)</span>
                            {% endif %}
                            {% if esCorrectaA %}
                                {% if not esCorrectaYSeleccionadaA %}
                                    <span style="color: var(--color-success); font-weight: bold;">‚Üê Respuesta correcta</span>
                                {% endif %}
                            {% endif %}
                        </div>
                        {# Opci√≥n B #}
                        {% set esCorrectaB = respuestaCorrectaNormalizada == 'B' %}
                        {% set esSeleccionadaB = respuestaAlumnoNormalizada == 'B' %}
                        {% set esIncorrectaB = esSeleccionadaB and not item.esCorrecta %}
                        {% set esCorrectaYSeleccionadaB = esSeleccionadaB and item.esCorrecta %}
                        <div style="padding: 0.5rem; margin: 0.25rem 0; {% if esIncorrectaB %}background: #ffebee;{% elseif esCorrectaB %}background: #e8f5e9; border-left: 3px solid var(--color-success);{% endif %}">
                            <strong>B)</strong> {{ item.pregunta.opcionB }}
                            {% if esCorrectaYSeleccionadaB %}
                                <span style="color: var(--color-success); font-weight: bold;">‚Üê Tu respuesta (correcta)</span>
                            {% elseif esIncorrectaB %}
                                <span style="color: var(--color-danger);">‚Üê Tu respuesta (incorrecta)</span>
                            {% endif %}
                            {% if esCorrectaB %}
                                {% if not esCorrectaYSeleccionadaB %}
                                    <span style="color: var(--color-success); font-weight: bold;">‚Üê Respuesta correcta</span>
                                {% endif %}
                            {% endif %}
                        </div>
                        {# Opci√≥n C #}
                        {% set esCorrectaC = respuestaCorrectaNormalizada == 'C' %}
                        {% set esSeleccionadaC = respuestaAlumnoNormalizada == 'C' %}
                        {% set esIncorrectaC = esSeleccionadaC and not item.esCorrecta %}
                        {% set esCorrectaYSeleccionadaC = esSeleccionadaC and item.esCorrecta %}
                        <div style="padding: 0.5rem; margin: 0.25rem 0; {% if esIncorrectaC %}background: #ffebee;{% elseif esCorrectaC %}background: #e8f5e9; border-left: 3px solid var(--color-success);{% endif %}">
                            <strong>C)</strong> {{ item.pregunta.opcionC }}
                            {% if esCorrectaYSeleccionadaC %}
                                <span style="color: var(--color-success); font-weight: bold;">‚Üê Tu respuesta (correcta)</span>
                            {% elseif esIncorrectaC %}
                                <span style="color: var(--color-danger);">‚Üê Tu respuesta (incorrecta)</span>
                            {% endif %}
                            {% if esCorrectaC %}
                                {% if not esCorrectaYSeleccionadaC %}
                                    <span style="color: var(--color-success); font-weight: bold;">‚Üê Respuesta correcta</span>
                                {% endif %}
                            {% endif %}
                        </div>
                        {# Opci√≥n D #}
                        {% set esCorrectaD = respuestaCorrectaNormalizada == 'D' %}
                        {% set esSeleccionadaD = respuestaAlumnoNormalizada == 'D' %}
                        {% set esIncorrectaD = esSeleccionadaD and not item.esCorrecta %}
                        {% set esCorrectaYSeleccionadaD = esSeleccionadaD and item.esCorrecta %}
                        <div style="padding: 0.5rem; margin: 0.25rem 0; {% if esIncorrectaD %}background: #ffebee;{% elseif esCorrectaD %}background: #e8f5e9; border-left: 3px solid var(--color-success);{% endif %}">
                            <strong>D)</strong> {{ item.pregunta.opcionD }}
                            {% if esCorrectaYSeleccionadaD %}
                                <span style="color: var(--color-success); font-weight: bold;">‚Üê Tu respuesta (correcta)</span>
                            {% elseif esIncorrectaD %}
                                <span style="color: var(--color-danger);">‚Üê Tu respuesta (incorrecta)</span>
                            {% endif %}
                            {% if esCorrectaD %}
                                {% if not esCorrectaYSeleccionadaD %}
                                    <span style="color: var(--color-success); font-weight: bold;">‚Üê Respuesta correcta</span>
                                {% endif %}
                            {% endif %}
                        </div>
                        {% if item.esCorrecta is null %}
                            <div style="margin-top: 0.5rem; padding: 0.5rem; background-color:rgb(210, 205, 191); border-radius: 4px; border-left: 3px solidrgb(234, 224, 194); color: #856404;">
                                <strong>‚ö†Ô∏è No respondiste esta pregunta.</strong> La respuesta correcta est√° marcada arriba para que puedas revisarla.
                            </div>
                        {% endif %}
                    </div>

                    {% if item.pregunta.retroalimentacion %}
                        <div class="alert alert-info" style="margin-top: 1rem; line-height: 1.6;">
                            <strong>Retroalimentaci√≥n:</strong> 
                            <div style="margin-top: 0.5rem;">{{ item.pregunta.retroalimentacion|markdown|raw }}</div>
                        </div>
                    {% endif %}

                    {% if not esMunicipal and not esConvocatoria and item.pregunta.articulo is defined and item.pregunta.articulo %}
                        {% if item.pregunta.articulo.explicacion or item.pregunta.articulo.textoLegal %}
                        <details style="margin-top: 1rem;">
                            <summary style="cursor: pointer; font-weight: bold; color: var(--color-primary);">Ver Informaci√≥n del Art√≠culo</summary>
                            <div style="margin-top: 0.5rem;">
                                <p><strong>Art√≠culo {{ item.pregunta.articulo.getNumeroCompleto() }} - {{ item.pregunta.ley.nombre }}</strong></p>
                                {% if item.pregunta.articulo.explicacion %}
                                <div style="background: #e3f2fd; padding: 1rem; border-radius: 4px; margin-top: 0.5rem; border-left: 4px solid var(--color-secondary); line-height: 1.6;">
                                    <strong>Explicaci√≥n para el Opositor:</strong>
                                    <div style="margin-top: 0.5rem;">{{ item.pregunta.articulo.explicacion|markdown|raw }}</div>
                                </div>
                                {% endif %}
                                {% if item.pregunta.articulo.textoLegal %}
                                <div style="background: #fff3cd; padding: 1rem; border-radius: 4px; margin-top: 0.5rem; border-left: 4px solid #ffc107; line-height: 1.6;">
                                    <strong>Texto Legal:</strong>
                                    <div style="margin-top: 0.5rem;">{{ item.pregunta.articulo.textoLegal|raw }}</div>
                                </div>
                                {% endif %}
                            </div>
                        </details>
                        {% endif %}
                    {% endif %}
                </div>
            </div>
        {% endfor %}

        <div class="d-flex gap-2 mt-4">
            {% if is_granted('ROLE_PROFESOR') or is_granted('ROLE_ADMIN') %}
                <a href="{{ path('app_examen_profesor') }}" class="btn btn-secondary">Volver a Ex√°menes</a>
            {% else %}
                <a href="{{ path('app_examen_historial') }}" class="btn btn-secondary">Volver al Historial</a>
            {% endif %}
            <a href="{{ path('app_dashboard') }}" class="btn btn-secondary">Volver al Dashboard</a>
        </div>
    </div>
</div>

<style>
    /* Estilos para filtros de preguntas */
    .filtro-pregunta {
        accent-color: var(--color-primary, #0071b5);
    }
    
    #filtros-preguntas label {
        transition: opacity 0.2s;
    }
    
    #filtros-preguntas label:hover {
        opacity: 0.8;
    }
    
    /* Responsive para m√≥viles - filtros */
    @media (max-width: 768px) {
        /* Contenedor de filtros */
        #filtros-preguntas {
            padding: 0.75rem !important;
        }
        
        /* Labels de filtros m√°s grandes para m√≥viles */
        #filtros-preguntas label {
            min-height: 44px !important; /* Tama√±o t√°ctil recomendado */
            padding: 0.25rem 0 !important;
            font-size: 0.9rem !important;
        }
        
        /* Checkboxes m√°s grandes en m√≥viles */
        .filtro-pregunta {
            width: 20px !important;
            height: 20px !important;
            min-width: 20px !important;
            min-height: 20px !important;
        }
        
        /* Espaciado entre filtros en m√≥viles */
        #filtros-preguntas > div {
            flex-direction: column !important;
            align-items: flex-start !important;
            gap: 0.75rem !important;
        }
    }
</style>

<script>
    // Filtrado de preguntas seg√∫n checkboxes
    document.addEventListener('DOMContentLoaded', function() {
        const filtros = document.querySelectorAll('.filtro-pregunta');
        const preguntas = document.querySelectorAll('.pregunta-item');
        
        function aplicarFiltros() {
            const filtroCorrectas = document.getElementById('filtro-correctas').checked;
            const filtroIncorrectas = document.getElementById('filtro-incorrectas').checked;
            const filtroEnBlanco = document.getElementById('filtro-en-blanco').checked;
            
            preguntas.forEach(pregunta => {
                const esCorrecta = pregunta.classList.contains('pregunta-correcta');
                const esIncorrecta = pregunta.classList.contains('pregunta-incorrecta');
                const esEnBlanco = pregunta.classList.contains('pregunta-en-blanco');
                
                let mostrar = false;
                if (esCorrecta && filtroCorrectas) mostrar = true;
                if (esIncorrecta && filtroIncorrectas) mostrar = true;
                if (esEnBlanco && filtroEnBlanco) mostrar = true;
                
                if (mostrar) {
                    pregunta.style.display = '';
                } else {
                    pregunta.style.display = 'none';
                }
            });
        }
        
        filtros.forEach(filtro => {
            filtro.addEventListener('change', aplicarFiltros);
        });
    });

    // Scroll suave al hacer clic en los n√∫meros de preguntas
    document.addEventListener('DOMContentLoaded', function() {
        const preguntaLinks = document.querySelectorAll('.pregunta-link-detalle');
        preguntaLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const targetId = this.getAttribute('href');
                const targetElement = document.querySelector(targetId);
                if (targetElement) {
                    // Calcular offset para que la pregunta quede visible (considerando header fijo si existe)
                    const offset = 80; // Ajustar seg√∫n sea necesario
                    const targetPosition = targetElement.getBoundingClientRect().top + window.pageYOffset - offset;
                    
                    window.scrollTo({
                        top: targetPosition,
                        behavior: 'smooth'
                    });
                    
                    // Resaltar brevemente la pregunta al llegar
                    setTimeout(() => {
                        targetElement.style.transition = 'box-shadow 0.3s';
                        targetElement.style.boxShadow = '0 0 0 3px rgba(0, 113, 181, 0.3)';
                        setTimeout(() => {
                            targetElement.style.boxShadow = '';
                        }, 1000);
                    }, 500);
                }
            });
        });
    });
</script>
{% endblock %}

