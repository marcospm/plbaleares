{% extends 'base.html.twig' %}

{% block title %}Artículo {{ articulo.numero }} - Sistema de Oposiciones{% endblock %}

{% block body %}
<div class="card">
    <div class="card-header">
        <h1>Artículo {{ articulo.numero }}{% if articulo.nombre %} - {{ articulo.nombre }}{% endif %}</h1>
    </div>
    <div class="card-body">
        {% if articulo.nombre %}
        <div class="form-group">
            <label class="form-label"><strong>Nombre:</strong></label>
            <p style="font-size: 1.1rem; color: var(--color-primary);">{{ articulo.nombre }}</p>
        </div>
        {% endif %}
        <div class="form-group">
            <label class="form-label"><strong>Ley:</strong></label>
            <p style="font-size: 1.1rem; color: var(--color-primary);">{{ articulo.ley.nombre }}</p>
        </div>

        <div class="form-group">
            <label class="form-label"><strong>Explicación para el Opositor:</strong></label>
            <div style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); padding: 1.5rem; border-radius: 8px; border-left: 4px solid var(--color-secondary); box-shadow: 0 2px 4px rgba(0,0,0,0.05); line-height: 1.6;">
                {{ articulo.explicacion|default('Sin explicación disponible')|markdown|raw }}
            </div>
        </div>

        {% if articulo.video and articulo.video|trim != '' %}
        <div class="form-group">
            <label class="form-label"><strong>Video Explicativo:</strong></label>
            <div style="max-width: 100%; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); overflow: hidden; background: #000; margin-top: 0.5rem;">
                <video controls style="width: 100%; display: block;" preload="metadata">
                    <source src="{{ articulo.video }}" type="video/mp4">
                    <source src="{{ articulo.video }}" type="video/webm">
                    <source src="{{ articulo.video }}" type="video/ogg">
                    Tu navegador no soporta el elemento de video.
                </video>
            </div>
        </div>
        {% endif %}

        {% if is_granted('ROLE_USER') and not is_granted('ROLE_PROFESOR') and not is_granted('ROLE_ADMIN') %}
        <div class="card" style="margin-top: 2rem; border-left: 4px solid #FF9800;">
            <div class="card-header" style="background-color: #fff3cd;">
                <h3 style="margin: 0; color: #856404;">⚠️ Reportar Error o Solicitar Corrección</h3>
            </div>
            <div class="card-body">
                <form method="post" action="{{ path('app_articulo_reportar_error', {'id': articulo.id}) }}">
                    <input type="hidden" name="_token" value="{{ csrf_token('reportar_error_' ~ articulo.id) }}">
                    <div class="form-group">
                        <label class="form-label"><strong>Mensaje:</strong></label>
                        <textarea name="mensaje" class="form-control" rows="4" placeholder="Describe el error o la corrección que necesitas..." required style="width: 100%;"></textarea>
                        <small style="color: #666; font-size: 0.85rem;">Los profesores y administradores serán notificados de tu solicitud.</small>
                    </div>
                    <button type="submit" class="btn btn-warning">Enviar Reporte</button>
                </form>
            </div>
        </div>
        {% endif %}

        <div class="d-flex gap-2 mt-4">
            <a href="{{ path('app_articulo_publico_index', {'ley': leySeleccionada ?? 0, 'search': search ?? ''}) }}" class="btn btn-secondary">Volver a Artículos</a>
        </div>
    </div>
</div>
{% endblock %}

