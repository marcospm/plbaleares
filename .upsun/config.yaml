applications:
  app:
    source:
      root: "/"

    type: "php:8.4"

    web:
      locations:
        "/":
          root: "public"
          passthru: "/index.php"

    relationships:
      database: "database:mysql"

    mounts:
      "/var": "shared:files/var"
      "/public/uploads": "shared:files/uploads"

    variables:
      env:
        APP_ENV: "prod"
        APP_DEBUG: "0"

    hooks:
      build: |
        set -e
        composer install \
          --no-dev \
          --prefer-dist \
          --no-progress \
          --no-interaction \
          --optimize-autoloader

      deploy: |
        set -e

        # Ejecutar migraciones Doctrine
        php bin/console doctrine:migrations:migrate \
          --no-interaction \
          --allow-no-migration

        # Cache Symfony
        php bin/console cache:clear --no-warmup
        php bin/console cache:warmup
